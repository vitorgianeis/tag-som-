<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tag Som e Luz - Sistema Integrado</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
</head>
<body>

    <!-- Página de Login -->
    <div class="login-page" id="loginPage">
        <!-- Efeitos de fundo -->
        <div class="background-effects">
            <div class="light-beam"></div>
            <div class="light-beam"></div>
        </div>
        
        <!-- Cabeçalho -->
        <header class="logo-header">
            <h1>TAG SOM E LUZ</h1>
            <p>Soluções profissionais em sonorização e iluminação</p>
        </header>
        
        <!-- Conteúdo Principal -->
       
            
            <!-- Formulário de Login -->
            <div class="form-container">
                <div class="form-box">
                    <div class="form-logo">
                         <img src="src/tag.png" >
                    </div>
                    
                    <form id="login-form">
                        <div class="input-group">
                            <i class="fas fa-user"></i>
                            <input type="text" name="username" placeholder="Usuário ou e-mail" required>
                        </div>
                        
                        <div class="input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" name="password" placeholder="Senha" required>
                        </div>
                        
                        <input type="submit" value="Acessar o Sistema">
                    </form>
                    
                    
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sistema Principal -->
    <div class="app-container" id="appContainer" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <h1>Tag</h1>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-page="dashboard">
                        <i class="fas fa-home"></i>
                        <span>TAG</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="equipamentos">
                        <i class="fas fa-boxes"></i>
                        <span>Equipamentos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="eventos">
                        <i class="fas fa-calendar-alt"></i>
                        <span> Gerenciamento de Eventos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="orcamentos">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>Orçamentos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="agendamento">
                        <i class="fas fa-calendar-check"></i>
                        <span>Agendamento</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-cog"></i>
                        <span>Configurações</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Conteúdo Principal -->
        <div class="main-content">
            <!-- Topbar -->
            <div class="topbar">
                <div class="page-title" id="currentPageTitle">TAG SOM E LUS</div>
                <div class="user-info">
                    <div class="user-avatar">TAG</div>
                    <div class="user-name">gianeis</div>
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
            
            <!-- Dashboard -->
            <div class="page active" id="dashboard">
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <i class="fas fa-boxes fa-2x"></i>
                        <div class="stat-value">243</div>
                        <div class="stat-label">Equipamentos</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-calendar-check fa-2x"></i>
                        <div class="stat-value">12</div>
                        <div class="stat-label">Eventos Ativos</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-file-invoice-dollar fa-2x"></i>
                        <div class="stat-value">8</div>
                        <div class="stat-label">Orçamentos</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check-circle fa-2x"></i>
                        <div class="stat-value">86%</div>
                        <div class="stat-label">Checklists Concluídos</div>
                    </div>
                </div>
                
                
            </div>
            
            <!-- Página de Equipamentos -->
            <div class="page" id="equipamentos">
                
                <div class="equipamentos-container">
                    <h1><i class="fas fa-boxes"></i> Controle de Equipamentos</h1>
                    
                    <div class="filtros">
                        <select id="filtro-categoria2">
                            <option value="">Todas Categorias</option>
                            <option value="estrutura">Estruturas</option>
                            <option value="iluminacao">Iluminação</option>
                            <option value="som">Sonorização</option>
                            <option value="controle">Controles</option>
                            <option value="acessorio">Acessórios</option>
                        </select>
                        
                        <select id="filtro-local2">
                            <option value="">Todos Locais</option>
                            <option value="barracao">Barracão</option>
                            <option value="silene">Silene</option>
                            <option value="san-carlo">San Carlo</option>
                        </select>
                        
                        <input type="text" id="busca2" placeholder="Pesquisar equipamento...">
                    </div>
                    
                    <table id="tabela-equipamentos2">
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Local</th>
                                <th>Observações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dados serão inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="equipamentos-container">
                    <h1><i class="fas fa-boxes"></i> Equipamentos Recentes</h1>
                    
                    <div class="filtros">
                        <select id="filtro-categoria">
                            <option value="">Todas Categorias</option>
                            <option value="estrutura">Estruturas</option>
                            <option value="iluminacao">Iluminação</option>
                            <option value="som">Sonorização</option>
                            <option value="som">Painel de LED</option>
                            <option value="controle">Controles</option>
                            <option value="acessorio">Acessórios</option>
                        </select>
                        
                        <select id="filtro-local">
                            <option value="">Todos Locais</option>
                            <option value="barracao">Barracão</option>
                            <option value="silene">Silene</option>
                            <option value="san-carlo">San Carlo</option>
                        </select>
                        
                        <input type="text" id="busca" placeholder="Pesquisar equipamento...">
                    </div>
                    
                    <table id="tabela-equipamentos">
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Quantidade</th>
                                <th>Local</th>
                                <th>Observações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dados serão inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Página de Eventos -->
            <div class="page" id="eventos">
                <div class="eventos-container">
                    <h1><i class="fas fa-calendar-alt"></i> Gerenciamento de Eventos</h1>
                    
                    <!-- Abas -->
                    <div class="abas">
                        <div class="aba ativa" onclick="abrirAba('orcamento')">Orçamento</div>
                        <div class="aba" onclick="abrirAba('checklist')">Checklist Operacional</div>
                        <div class="aba" onclick="abrirAba('eventos-agendados')">Eventos Agendados</div>
                    </div>
                    
                    <!-- Aba Orçamento -->
                    <div id="orcamento" class="conteudo-aba ativa">
                        <h2>Novo Orçamento</h2>
                        
                        <form id="form-orcamento">
                            <div class="form-group">
                                <label for="cliente">Cliente*</label>
                                <input type="text" id="cliente" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="evento">Tipo de Evento*</label>
                                <select id="evento" required>
                                    <option value="">Selecione...</option>
                                    <option value="casamento">Casamento</option>
                                    <option value="show">Show</option>
                                    <option value="corporativo">Evento Corporativo</option>
                                    <option value="festa">Festa Particular</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="data">Data do Evento*</label>
                                <input type="date" id="data" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="local">Local*</label>
                                <input type="text" id="local" required placeholder="Endereço completo">
                            </div>
                            
                            <div class="form-group">
                                <label for="observacoes">Detalhes do Evento</label>
                                <textarea id="observacoes" placeholder="Número de convidados, horários, necessidades especiais..."></textarea>
                            </div>
                            
                            <h3>Equipamentos Necessários</h3>
                            <div class="equipamentos-lista" id="lista-equipamentos">
                                <!-- Gerado dinamicamente pelo JavaScript -->
                            </div>
                            
                            <div style="margin-top: 20px; font-size: 1.2rem;">
                                Total: R$ <span id="total-orcamento-form">0.00</span>
                            </div>
                            
                            <button type="submit" class="btn">GERAR ORÇAMENTO</button>
                        </form>
                    </div>
                    
                    <!-- Aba Checklist -->
                    <div id="checklist" class="conteudo-aba">
                        <h2>Checklist Operacional</h2>
                        
                        <div class="form-group">
                            <label for="selecionar-evento">Selecione o Evento:</label>
                            <select id="selecionar-evento" class="form-control">
                                <option value="">Carregando eventos...</option>
                            </select>
                        </div>
                        
                        <div id="detalhes-evento" style="display: none;">
                            <h3>Informações do Evento</h3>
                            <p><strong>Cliente:</strong> <span id="checklist-cliente"></span></p>
                            <p><strong>Data:</strong> <span id="checklist-data"></span></p>
                            <p><strong>Local:</strong> <span id="checklist-local"></span></p>
                            
                            <h3 style="margin-top: 30px;">Checklist de Equipamentos</h3>
                            <div id="checklist-equipamentos">
                                <!-- Gerado dinamicamente -->
                            </div>
                            
                            <div class="form-group" style="margin-top: 30px;">
                                <label for="responsavel">Responsável pela Montagem:</label>
                                <input type="text" id="responsavel" placeholder="Nome do funcionário">
                            </div>
                            
                            <button class="btn" onclick="salvarChecklist()">SALVAR CHECKLIST</button>
                        </div>
                    </div>
                    
                    <!-- Aba Eventos Agendados -->
                    <div id="eventos-agendados" class="conteudo-aba">
                        <h2>Eventos Agendados</h2>
                        <div id="lista-eventos">
                            <option value="aprovado">Aprovado</option>
                            
                            <!-- Gerado dinamicamente -->
                        </div>

                        
                    </div>
                </div>
            </div>
            
            <!-- Página de Orçamentos -->
            <div class="page" id="orcamentos">
                <div class="orcamento-container">
                    <div class="orcamento-header">
                        <h1><i class="fas fa-file-invoice-dollar"></i> Orçamentos</h1>
                        <button class="btn" onclick="novoOrcamento()">
                            <i class="fas fa-plus"></i> Novo Orçamento
                        </button>
                    </div>
                    
                    <div class="filtros">
                        <select id="filtro-status">
                            <option value="">Todos os Status</option>
                            <option value="pendente">Pendente</option>
                            <option value="aprovado">Aprovado</option>
                            <option value="recusado">Recusado</option>
                        </select>
                        
                        <input type="text" id="busca-orcamento" placeholder="Pesquisar orçamento...">
                    </div>
                    
                    <div id="lista-orcamentos">
                        <!-- Orçamentos serão carregados aqui -->
                    </div>
                    
                </div>
                
                <!-- Detalhes do Orçamento (inicialmente oculto) -->
                <div id="detalhes-orcamento" style="display: none;">
                    <div class="orcamento-container">
                        <div class="orcamento-header">
                            <h1 id="orcamento-titulo">Detalhes do Orçamento</h1>
                            <button class="btn" id="btn-export">
                                <i class="fas fa-file-pdf"></i> Exportar PDF
                            </button>
                        </div>
                        
                        <div class="orcamento-info">
                            <div class="info-card">
                                <h3>Cliente</h3>
                                <p id="orc-cliente">-</p>
                            </div>
                            
                            <div class="info-card">
                                <h3>Data do Evento</h3>
                                <p id="orc-data">-</p>
                            </div>
                            
                            <div class="info-card">
                                <h3>Local</h3>
                                <p id="orc-local">-</p>
                            </div>
                            
                            <div class="info-card">
                                <h3>Status</h3>
                                <p id="orc-status">-</p>
                            </div>
                        </div>
                        
                        <h3>Equipamentos</h3>
                        <table class="equipamentos-table">
                            <thead>
                                <tr>
                                    <th>Equipamento</th>
                                    <th>Quantidade</th>
                                    <th>Dias</th>
                                    <th>Valor Unitário</th>
                                    <th>Subtotal</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-equipamentos-orc">
                                <!-- Itens serão preenchidos por JS -->
                            </tbody>
                        </table>
                        
                        <div class="total-orcamento">
                            Total: <span id="total-orcamento">R$ 0,00</span>
                        </div>
                        
                        <div style="margin-top: 30px; display: flex; gap: 15px;">
                <button class="btn" style="background: var(--success);" id="btn-aprovar">Aprovar Orçamento</button>
                <button class="btn" style="background: var(--danger);" id="btn-recusar">Recusar Orçamento</button>
                <button class="btn" style="background: var(--dark);" id="btn-deletar">
                    <i class="fas fa-trash"></i> Excluir aqui
                </button>
                <button class="btn" onclick="fecharDetalhes()">Voltar</button>
            </div>
                    </div>
                </div>
            </div>
            
            <!-- Página de Agendamento -->
            <div class="page" id="agendamento">
                <div class="eventos-container">
                    <h1><i class="fas fa-calendar-alt"></i> Agenda de Eventos</h1>
                    
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <h2 id="current-month">Junho 2024</h2>
                            <div class="calendar-nav">
                                <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
                                <button id="today">Hoje</button>
                                <button id="next-month"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                        
                        <div class="calendar-grid" id="calendar-grid">
                            <!-- Dias serão gerados dinamicamente -->
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h2>Eventos Agendados</h2>
                        <div id="eventos-lista">
                            <!-- Eventos serão listados aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes do Evento -->
    <div class="modal" id="event-modal">
        <div class="modal-content">
            <span class="close-modal" id="close-modal">&times;</span>
            <h2 id="modal-title">Detalhes do Evento</h2>
            
            <div class="form-group">
                <label for="event-cliente">Cliente</label>
                <input type="text" id="event-cliente" readonly>
            </div>
            
            <div class="form-group">
                <label for="event-data">Data</label>
                <input type="text" id="event-data" readonly>
            </div>
            
            <div class="form-group">
                <label for="event-local">Local</label>
                <input type="text" id="event-local" readonly>
            </div>
            
            <div class="form-group">
                <label for="event-tipo">Tipo de Evento</label>
                <input type="text" id="event-tipo" readonly>
            </div>
            
            <div class="form-group">
                <label>Equipamentos</label>
                <div id="event-equipamentos" style="max-height: 200px; overflow-y: auto; background: rgba(40,40,40,0.8); padding: 10px; border-radius: 5px;"></div>
            </div>
            
            <div class="form-group">
                <label for="event-responsavel">Responsável</label>
                <input type="text" id="event-responsavel">
            </div>
            
            <div class="form-group">
                <label for="event-observacoes">Observações</label>
                <textarea id="event-observacoes" rows="3"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn" id="btn-salvar-evento">Salvar</button>
                <button class="btn" style="background: var(--danger);" id="btn-cancelar-evento">Cancelar Evento</button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação de Exclusão -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="confirmation-content">
            <h2><i class="fas fa-exclamation-triangle" style="color: var(--warning); margin-bottom: 15px;"></i></h2>
            <h3>Confirmar Exclusão</h3>
            <p>Tem certeza que deseja excluir permanentemente este orçamento?</p>
            <p style="font-size: 0.9rem; color: var(--gray); margin-top: 10px;">Esta ação não pode ser desfeita.</p>
            
            <div class="confirmation-buttons">
                <button class="btn-cancel" id="btn-cancel-delete">Cancelar</button>
                <button class="btn-confirm" id="btn-confirm-delete">Excluir Permanentemente</button>
            </div>
        </div>
    </div>


    

    <script>
        // Banco de dados simulado
        let eventos = JSON.parse(localStorage.getItem('eventosTag')) || [
            {
                id: 1,
                cliente: "Ana Silva",
                tipoEvento: "Casamento",
                data: "2024-06-15",
                local: "Salão de Festas Jardim das Flores",
                equipamentos: [
                    { nome: "Caixa de Som JBL 15\"", quantidade: 4 },
                    { nome: "Canhão de Luz RGB 200W", quantidade: 12 }
                ],
                responsavel: "Carlos Oliveira",
                observacoes: "Cerimônia às 16h, recepção às 18h",
                status: "confirmado"
            },
            {
                id: 2,
                cliente: "Produções Musicais LTDA",
                tipoEvento: "Show de Rock",
                data: "2024-06-20",
                local: "Teatro Municipal",
                equipamentos: [
                    { nome: "Caixa de Som JBL 15\"", quantidade: 8 },
                    { nome: "Estrutura Metálica Q30", quantidade: 1 },
                    { nome: "Máquina de Fumaça", quantidade: 2 }
                ],
                responsavel: "Roberto Santos",
                observacoes: "Soundcheck às 17h",
                status: "confirmado"
            }
        ];
        let orcamentos = JSON.parse(localStorage.getItem('orcamentosTag')) || [];
        let equipamentosDisponiveis = [
            { id: 1, nome: "Caixa de Som JBL 15\"", categoria: "som", diaria: 180 },
            { id: 2, nome: "Canhão de Luz RGB 200W", categoria: "iluminacao", diaria: 120 },
            { id: 3, nome: "Microfone Sem Fio Shure", categoria: "som", diaria: 80 },
            { id: 4, nome: "Estrutura Metálica Q30", categoria: "estrutura", diaria: 300 },
            { id: 5, nome: "Mesa de Som Behringer", categoria: "som", diaria: 150 },
            { id: 6, nome: "Projetor 5000 Lumens", categoria: "projecao", diaria: 200 },
            { id: 7, nome: "Máquina de Fumaça", categoria: "efeitos", diaria: 90 }
        ];

        // Dados dos equipamentos (extraídos do PDF)
        const equipamentos = [
    { material: "Estrutura Q30", quantidade: "43m total", local: "barracão", categoria: "estrutura" },
    { material: "1 metrô", quantidade: "4", local: "barracão", categoria: "estrutura" },
    { material: "1,5 metro", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "2,5 metro", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "3 metro", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Cubos", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Pés", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Curva grande", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Curva pequenas", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Sliver", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "pal de carga", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Cinta de Sliver", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Estrutura Q20", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "1metro", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "1metro", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "0,5", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Curva grande", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Curva pequena", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Cubos", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "cubo", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Escada", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Pequena", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Grande", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Pista de LED", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "placas de LED", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "placas infinytparis", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "placas Paris", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "placas de DJ Paris", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "Placas de LED Paris", quantidade: "36", local: "barracão", categoria: "iluminacao", obs: "32 funcionando" },
    { material: "Caixas de Som", quantidade: "", local: "barracão", categoria: "som" },
    { material: "grave 18 leacs", quantidade: "", local: "barracão", categoria: "som" },
    { material: "grave 15 JBL Selenium", quantidade: "", local: "barracão", categoria: "som" },
    { material: "caixa 12 JBL Selenium master", quantidade: "", local: "barracão", categoria: "som" },
    { material: "caixa 12 JBL Selenium JBL", quantidade: "", local: "barracão", categoria: "som" },
    { material: "caixa 12 JBL Selenium master", quantidade: "", local: "barracão", categoria: "som" },
    { material: "caixa 15 JBL Selenium master", quantidade: "2", local: "barracão", categoria: "som" },
    { material: "caixa 15 transdutori", quantidade: "", local: "barracão", categoria: "som" },
    { material: "caixa de 15 passiva", quantidade: "", local: "barracão", categoria: "som" },
    { material: "graves 18 duplo", quantidade: "", local: "barracão", categoria: "som" },
    { material: "Palco", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "módulos 2x1", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "tábua 2x1", quantidade: "", local: "barracão", categoria: "estrutura" },
    { material: "Iluminação", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "canhão", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "canhão amber", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "canhão RGB", quantidade: "60", local: "barracão", categoria: "iluminacao", obs: "aproximadamente" },
    { material: "canhão RGB banda", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "canhão RGB Silene", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "luz néon", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "ribalta UV", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "lâmpada luz Negra", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "estrobo", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "estrobo de LED", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "estrobo lâmpada", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "laser", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "wale", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "wale", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "wale silene", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "movie de led", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "muvie de led", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "muvie de led", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "globos espelhados", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "caixa de madeira 30cm", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "caixas de papelão", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "globos grande", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "globos de 30cm", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "projeto", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "skypaper", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "iluminação externa/interna", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "refletores", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "refletor de led 50w", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "refletor de lâmpada P", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "refletor de lâmpada G", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "canhão lâmpada", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "HQI", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "reator HQI", quantidade: "", local: "barracão", categoria: "iluminacao" },
    { material: "pim bim", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "microfone", quantidade: "", local: "barracão", categoria: "som" },
    { material: "Mic karsect", quantidade: "", local: "barracão", categoria: "som" },
    { material: "Mic heat set", quantidade: "", local: "barracão", categoria: "som" },
    { material: "Mic AKG", quantidade: "2 base com 1 mic", local: "barracão", categoria: "som" },
    { material: "Mic com fio shure", quantidade: "", local: "barracão", categoria: "som" },
    { material: "Mic lê som", quantidade: "", local: "barracão", categoria: "som" },
    { material: "Tripé", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "pedestal", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "fumaça", quantidade: "5", local: "barracão", categoria: "acessorio" },
    { material: "infláveis", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "estrelas", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "quadrado", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "tubo", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "culer", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "mesa de iluminação", quantidade: "", local: "barracão", categoria: "controle" },
    { material: "Control DMX512 preta", quantidade: "3", local: "barracão", categoria: "controle" },
    { material: "control dmx 512 operator", quantidade: "", local: "barracão", categoria: "controle" },
    { material: "control dmx 512 verde", quantidade: "", local: "barracão", categoria: "controle" },
    { material: "control 512 pista infinytparis", quantidade: "", local: "barracão", categoria: "controle" },
    { material: "control 512 pista de led", quantidade: "", local: "barracão", categoria: "controle" },
    { material: "control 512 azul", quantidade: "", local: "barracão", categoria: "controle" },
    { material: "Pilot", quantidade: "", local: "barracão", categoria: "controle" },
    { material: "mesa de som", quantidade: "", local: "barracão", categoria: "som" },
    { material: "oneal", quantidade: "", local: "barracão", categoria: "som" },
    { material: "behringer", quantidade: "", local: "barracão", categoria: "som" },
    { material: "wattsom P", quantidade: "", local: "barracão", categoria: "som" },
    { material: "wattsom G", quantidade: "", local: "barracão", categoria: "som" },
    { material: "Televisões", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "Philco 48", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "Philco 39", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "Philco 43", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "Philco 39", quantidade: "", local: "barracão", categoria: "acessorio" },
    { material: "controladora DJ", quantidade: "", local: "barracão", categoria: "controle" },
    { material: "wego", quantidade: "", local: "barracão", categoria: "controle" },
    { material: "ddj ergo", quantidade: "", local: "barracão", categoria: "controle" },
    { material: "xpoint", quantidade: "", local: "barracão", categoria: "controle" }
];

        // Variáveis para controle de exclusão
        let orcamentoAtualId = null; // Armazena o ID do orçamento sendo visualizado

        // Referências atuais para navegação no calendário
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let selectedEvent = null;

        // Nomes dos meses e dias
        const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", 
                           "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
        const dayNames = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"];

        // Função para carregar a tabela
       function carregarTabela(tableId, filtroCategoria = "", filtroLocal = "", busca = "") {
    const tbody = document.querySelector(`#${tableId} tbody`);
    tbody.innerHTML = "";
    
    const filtrados = equipamentos.filter(item => {
        const categoriaMatch = !filtroCategoria || item.categoria === filtroCategoria;
        const localMatch = !filtroLocal || item.local.includes(filtroLocal);
        const buscaMatch = !busca || item.material.toLowerCase().includes(busca.toLowerCase());
        
        return categoriaMatch && localMatch && buscaMatch;
    });
    
    if (filtrados.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">Nenhum equipamento encontrado</td></tr>`;
        return;
    }
    
    filtrados.forEach(item => {
        const classeLocal = item.local === "barracão" ? "status-barracao" : "status-outro";
        
        tbody.innerHTML += `
            <tr>
                <td>${item.material}</td>
                <td>${item.quantidade || "-"}</td>
                <td><span class="${classeLocal}">${item.local || "-"}</span></td>
                <td>${item.obs || "-"}</td>
            </tr>
        `;
    });
}
        
       // Login 1 tela aqui a
document.getElementById('login-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const username = this.username.value;
    const password = this.password.value;
    
    if(!username || !password) {
        alert('Por favor, preencha todos os campos!');
        return;
    }
    
    // Verificação de senha fixa
    const SENHA_CORRETA = "vitor123"; // Altere para a senha que desejar
    const USUARIO_CORRETO = "vitor"; // Altere para o usuário que desejar
    
    if(username === USUARIO_CORRETO && password === SENHA_CORRETA) {
        // Login bem-sucedido
        realizarLogin();
    } else {
        alert('Usuário ou senha incorretos!');
        // Limpar campo de senha
        this.password.value = '';
    }
});

function realizarLogin() {
    const formBox = document.querySelector('.form-box');
    formBox.style.transform = 'scale(0.98)';
    formBox.style.boxShadow = '0 5px 20px rgba(255, 107, 0, 0.3)';
    
    setTimeout(() => {
        formBox.style.transform = '';
        formBox.style.boxShadow = '';
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('appContainer').style.display = 'flex';
        
        // Carregar dados iniciais
        carregarTabela('tabela-equipamentos');
        carregarTabela('tabela-equipamentos2');
        carregarEquipamentos();
        carregarEventosParaChecklist();
        carregarListaEventos();
        carregarOrcamentos();
        renderCalendar();
        loadEventsList();
    }, 500);
}
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function() {
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('loginPage').style.display = 'block';
            document.getElementById('login-form').reset();
            orcamentoAtualId = null; // Resetar ao fazer logout
        });
        
        // Navegação
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remover classe ativa de todos os links
                document.querySelectorAll('.nav-link').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Adicionar classe ativa ao link clicado
                this.classList.add('active');
                
                // Esconder todas as páginas
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                
                // Mostrar a página correspondente
                const pageId = this.getAttribute('data-page');
                if (pageId) {
                    document.getElementById(pageId).classList.add('active');
                    document.getElementById('currentPageTitle').textContent = 
                        this.querySelector('span').textContent;
                        
                    // Se for a página de eventos, carregar os dados
                    if (pageId === 'eventos') {
                        abrirAba('orcamento');
                    } else if (pageId === 'orcamentos') {
                        carregarOrcamentos();
                    } else if (pageId === 'agendamento') {
                        renderCalendar();
                        loadEventsList();
                    }
                }
            });
        });
        
        // Filtros Dashboard
        document.getElementById("filtro-categoria").addEventListener("change", (e) => {
            carregarTabela('tabela-equipamentos', e.target.value, document.getElementById("filtro-local").value, document.getElementById("busca").value);
        });
        
        document.getElementById("filtro-local").addEventListener("change", (e) => {
            carregarTabela('tabela-equipamentos', document.getElementById("filtro-categoria").value, e.target.value, document.getElementById("busca").value);
        });
        
        document.getElementById("busca").addEventListener("input", (e) => {
            carregarTabela('tabela-equipamentos', document.getElementById("filtro-categoria").value, document.getElementById("filtro-local").value, e.target.value);
        });
        
        // Filtros Página de Equipamentos
        document.getElementById("filtro-categoria2").addEventListener("change", (e) => {
            carregarTabela('tabela-equipamentos2', e.target.value, document.getElementById("filtro-local2").value, document.getElementById("busca2").value);
        });
        
        document.getElementById("filtro-local2").addEventListener("change", (e) => {
            carregarTabela('tabela-equipamentos2', document.getElementById("filtro-categoria2").value, e.target.value, document.getElementById("busca2").value);
        });
        
        document.getElementById("busca2").addEventListener("input", (e) => {
            carregarTabela('tabela-equipamentos2', document.getElementById("filtro-categoria2").value, document.getElementById("filtro-local2").value, e.target.value);
        });
        
        // Efeito de hover nas features
        const features = document.querySelectorAll('.feature');
        features.forEach(feature => {
            feature.addEventListener('mouseenter', () => {
                const icon = feature.querySelector('i');
                icon.style.transform = 'scale(1.2)';
                icon.style.color = '#FF9E00';
            });
            
            feature.addEventListener('mouseleave', () => {
                const icon = feature.querySelector('i');
                icon.style.transform = '';
                icon.style.color = '#FF6B00';
            });
        });
        
        // Funções para abas de eventos
        function abrirAba(abaId) {
            document.querySelectorAll('.conteudo-aba').forEach(aba => {
                aba.classList.remove('ativa');
            });
            
            document.querySelectorAll('.aba').forEach(aba => {
                aba.classList.remove('ativa');
            });
            
            document.getElementById(abaId).classList.add('ativa');
            document.querySelector(`.aba[onclick="abrirAba('${abaId}')"]`).classList.add('ativa');
            
            if (abaId === 'checklist') {
                carregarEventosParaChecklist();
            } else if (abaId === 'eventos-agendados') {
                carregarListaEventos();
            }
        }

        // Carrega equipamentos para seleção no orçamento
        function carregarEquipamentos() {
            const container = document.getElementById('lista-equipamentos');
            container.innerHTML = '';
            
            equipamentosDisponiveis.forEach(equip => {
                container.innerHTML += `
                    <div class="equipamento-card">
                        <h4>${equip.nome}</h4>
                        <p>R$ ${equip.diaria.toFixed(2)} /dia</p>
                        <div class="checkbox-container">
                            <input type="checkbox" id="equip-${equip.id}" value="${equip.id}">
                            <label for="equip-${equip.id}">          </label>
                        </div>
                        <div class="equipment-inputs" id="inputs-equip-${equip.id}" style="display: none; margin-top: 10px;">
                            <div>
                                <label>Quantidade: 
                                    <input type="number" min="1" value="1" id="qtd-equip-${equip.id}" style="width: 60px;">
                                </label>
                            </div>
                            <div>
                                <label>Dias: 
                                    <input type="number" min="1" value="1" id="dias-equip-${equip.id}" style="width: 60px;">
                                </label>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // Mostrar inputs quando seleciona
            document.querySelectorAll('#lista-equipamentos input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const inputsDiv = document.getElementById(`inputs-equip-${this.value}`);
                    inputsDiv.style.display = this.checked ? 'block' : 'none';
                    calcularTotalOrcamento();
                });
            });
            
            // Eventos para calcular total quando valores mudam
            document.getElementById('lista-equipamentos').addEventListener('input', function(e) {
                if (e.target.matches('input[type="number"]')) {
                    calcularTotalOrcamento();
                }
            });
        }
        
        // Calcular total do orçamento
        function calcularTotalOrcamento() {
            let total = 0;
            document.querySelectorAll('#lista-equipamentos input[type="checkbox"]:checked').forEach(checkbox => {
                const equipId = parseInt(checkbox.value);
                const qtd = parseInt(document.getElementById(`qtd-equip-${equipId}`).value) || 0;
                const dias = parseInt(document.getElementById(`dias-equip-${equipId}`).value) || 0;
                const equipamento = equipamentosDisponiveis.find(e => e.id === equipId);
                if (equipamento) {
                    total += equipamento.diaria * qtd * dias;
                }
            });
            document.getElementById('total-orcamento-form').textContent = total.toFixed(2);
        }

        // Formulário de orçamento
        document.getElementById('form-orcamento').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const dataInput = document.getElementById('data').value; // Já está no formato YYYY-MM-DD

            const equipamentosSelecionados = [];
            document.querySelectorAll('#lista-equipamentos input[type="checkbox"]:checked').forEach(checkbox => {
                const equipId = parseInt(checkbox.value);
                const qtd = parseInt(document.getElementById(`qtd-equip-${equipId}`).value);
                const dias = parseInt(document.getElementById(`dias-equip-${equipId}`).value);
                const equipamento = equipamentosDisponiveis.find(e => e.id === equipId);
                
                equipamentosSelecionados.push({
                    id: equipId,
                    nome: equipamento.nome,
                    quantidade: qtd,
                    dias: dias,
                    diaria: equipamento.diaria,
                    subtotal: equipamento.diaria * qtd * dias
                });
            });
            const novoOrcamento = {
                id: Date.now(),
                cliente: document.getElementById('cliente').value,
                evento: document.getElementById('evento').value,
                data: dataInput,
                local: document.getElementById('local').value,
                observacoes: document.getElementById('observacoes').value,
                equipamentos: equipamentosSelecionados,
                total: parseFloat(document.getElementById('total-orcamento-form').textContent),
                status: 'pendente' // status padrão
            };
            
            orcamentos.push(novoOrcamento);
            localStorage.setItem('orcamentosTag', JSON.stringify(orcamentos));
            
            alert('Orçamento criado com sucesso! ID: ' + novoOrcamento.id);
            this.reset();
            carregarEquipamentos();
            document.getElementById('total-orcamento-form').textContent = '0.00';
            
            // Ir para a página de orçamentos
            document.querySelector('.nav-link[data-page="orcamentos"]').click();
        });

        // Carrega orçamentos
        function carregarOrcamentos() {
            const container = document.getElementById('lista-orcamentos');
            container.innerHTML = '';
            
            if (orcamentos.length === 0) {
                container.innerHTML = '<p>Nenhum orçamento cadastrado ainda.</p>';
                return;
            }
            
            const filtroStatus = document.getElementById('filtro-status').value;
            const busca = document.getElementById('busca-orcamento').value.toLowerCase();
            
            const filtrados = orcamentos.filter(orc => {
                const statusMatch = !filtroStatus || orc.status === filtroStatus;
                const buscaMatch = !busca || 
                    (orc.cliente && orc.cliente.toLowerCase().includes(busca)) ||
                    (orc.evento && orc.evento.toLowerCase().includes(busca)) ||
                    (orc.local && orc.local.toLowerCase().includes(busca));
                
                return statusMatch && buscaMatch;
            });
            
            if (filtrados.length === 0) {
                container.innerHTML = '<p>Nenhum orçamento encontrado com os filtros selecionados.</p>';
                return;
            }
            
            filtrados.forEach(orc => {
                let statusClass = '';
                let statusText = '';
                
                if (orc.status === 'pendente') {
                    statusClass = 'status-pendente';
                    statusText = 'PENDENTE';
                } else if (orc.status === 'aprovado') {
                    statusClass = 'status-concluido';
                    statusText = 'APROVADO';
                } else if (orc.status === 'recusado') {
                    statusClass = 'status-recusado';
                    statusText = 'RECUSADO';
                }
                
                container.innerHTML += `
                    <div class="info-card">
                        <h3>${orc.cliente} - ${orc.evento}</h3>
                        <p><strong>Data:</strong> ${formatarData(orc.data)}</p>
                        <p><strong>Local:</strong> ${orc.local || 'Não informado'}</p>
                        <p><strong>Status:</strong> <span class="status ${statusClass}">${statusText}</span></p>
                        <p><strong>Valor:</strong> R$ ${typeof orc.total === 'number' ? orc.total.toFixed(2) : '0.00'}</p>
                        <button class="btn" style="margin-top: 10px;" onclick="visualizarOrcamento(${orc.id})">Detalhes</button>
                    </div>
                `;
            });
        }

        // Visualizar orçamento
        function visualizarOrcamento(id) {
            const orcamento = orcamentos.find(o => o.id === id);
            if (orcamento) {
                orcamentoAtualId = id; // Armazena o ID do orçamento atual
                
                document.getElementById('orcamento-titulo').textContent = `Orçamento #${orcamento.id}`;
                document.getElementById('orc-cliente').textContent = orcamento.cliente;
                document.getElementById('orc-data').textContent = formatarData(orcamento.data);
                document.getElementById('orc-local').textContent = orcamento.local;
                
                let statusText = '';
                let statusClass = '';
                if (orcamento.status === 'pendente') {
                    statusText = 'PENDENTE';
                    statusClass = 'status-pendente';
                } else if (orcamento.status === 'aprovado') {
                    statusText = 'APROVADO';
                    statusClass = 'status-concluido';
                } else {
                    statusText = 'RECUSADO';
                    statusClass = 'status-recusado';
                }
                document.getElementById('orc-status').innerHTML = `<span class="status ${statusClass}">${statusText}</span>`;
                
                const tbody = document.getElementById('tabela-equipamentos-orc');
                tbody.innerHTML = '';
                
                let total = 0;
                orcamento.equipamentos.forEach(item => {
                    const subtotal = item.diaria * item.quantidade * item.dias;
                    total += subtotal;
                    
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.nome}</td>
                            <td>${item.quantidade}</td>
                            <td>${item.dias}</td>
                            <td>R$ ${item.diaria.toFixed(2)}</td>
                            <td>R$ ${subtotal.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                document.getElementById('total-orcamento').textContent = `R$ ${total.toFixed(2)}`;
                
                // Configurar botões de aprovar/recusar
                document.getElementById('btn-aprovar').onclick = function() {
                    aprovarOrcamento(orcamento.id);
                };
                
                document.getElementById('btn-recusar').onclick = function() {
                    recusarOrcamento(orcamento.id);
                };
                
                // Configurar botão de exclusão
                document.getElementById('btn-deletar').onclick = function() {
                    mostrarConfirmacaoExclusao();
                };
                
                document.getElementById('lista-orcamentos').style.display = 'none';
                document.getElementById('detalhes-orcamento').style.display = 'block';
            }
        }
        
        // Função para mostrar modal de confirmação
        function mostrarConfirmacaoExclusao() {
            if (orcamentoAtualId === null) {
                alert("Nenhum orçamento selecionado!");
                return;
            }
            console.log("ID para exclusão:", orcamentoAtualId);
            document.getElementById('confirmationModal').style.display = 'flex';
        }

        // Função para fechar modal de confirmação
        function fecharConfirmacaoExclusao() {
            document.getElementById('confirmationModal').style.display = 'none';
        }

        // Função para deletar orçamento
        function deletarOrcamento() {
            if (orcamentoAtualId === null) return;
            
            try {
                const id = Number(orcamentoAtualId);
                const orcIndex = orcamentos.findIndex(o => o.id === id);
                
                if (orcIndex === -1) {
                    throw new Error(`Orçamento não encontrado: ${id}`);
                }

                orcamentos.splice(orcIndex, 1);
                localStorage.setItem('orcamentosTag', JSON.stringify(orcamentos));
                
                fecharDetalhes();
                carregarOrcamentos();
                fecharConfirmacaoExclusao();
                
                alert('Orçamento excluído com sucesso!');
                orcamentoAtualId = null;
            } catch (error) {
                console.error("Erro na exclusão:", error);
                alert("Falha ao excluir: " + error.message);
                fecharConfirmacaoExclusao();
            }
        }

        // Fechar detalhes do orçamento
        function fecharDetalhes() {
            document.getElementById('lista-orcamentos').style.display = 'grid';
            document.getElementById('detalhes-orcamento').style.display = 'none';
            orcamentoAtualId = null;
        }

        function aprovarOrcamento(id) {
            const orc = orcamentos.find(o => o.id === id);
            if (orc) {
                orc.status = 'aprovado';
                localStorage.setItem('orcamentosTag', JSON.stringify(orcamentos));
                
                // Corrigir a data antes de adicionar o evento
                adicionarEvento({
                    ...orc,
                    data: corrigirDataParaEvento(orc.data)
                });
                
                alert('Orçamento aprovado com sucesso! Evento agendado.');
                carregarOrcamentos();
                fecharDetalhes();
            }
        }

        function corrigirDataParaEvento(dataString) {
            if (!dataString || dataString.length < 10) return dataString;
            
            const ano = dataString.substring(0, 4);
            const mes = dataString.substring(5, 7);
            const dia = dataString.substring(8, 10);
            
            // Validar se os valores são numéricos
            if (isNaN(ano) || isNaN(mes) || isNaN(dia)) return dataString;
            
            const dataLocal = new Date(parseInt(ano), parseInt(mes) - 1, parseInt(dia));
            
            // Verificar se a data é válida
            if (isNaN(dataLocal.getTime())) return dataString;
            
            const anoCorrigido = dataLocal.getFullYear();
            const mesCorrigido = String(dataLocal.getMonth() + 1).padStart(2, '0');
            const diaCorrigido = String(dataLocal.getDate()).padStart(2, '0');
            
            return `${anoCorrigido}-${mesCorrigido}-${diaCorrigido}`;
        }

        function adicionarEvento(orcamento) {
            const novoEvento = {
                id: Date.now(),
                cliente: orcamento.cliente,
                tipoEvento: orcamento.evento,
                data: orcamento.data,
                local: orcamento.local,
                equipamentos: orcamento.equipamentos.map(eq => ({
                    nome: eq.nome,
                    quantidade: eq.quantidade
                })),
                responsavel: '',
                observacoes: orcamento.observacoes,
                status: "confirmado",
                checklist: orcamento.equipamentos.map(equip => ({
                    id: equip.id,
                    nome: equip.nome,
                    quantidade: equip.quantidade,
                    carregado: false,
                    montado: false,
                    testado: false
                }))
            };
            
            eventos.push(novoEvento);
            localStorage.setItem('eventosTag', JSON.stringify(eventos));
        }
        
        function recusarOrcamento(id) {
            const orc = orcamentos.find(o => o.id == id);
            if (!orc) return;

            if (!confirm('Tem certeza que deseja recusar este orçamento?')) {
                return;
            }

            orc.status = 'recusado';
            localStorage.setItem('orcamentosTag', JSON.stringify(orcamentos));
            
            alert('Orçamento recusado com sucesso!');
            carregarOrcamentos();
            fecharDetalhes();
        }

        function carregarEventosParaChecklist() {
            const select = document.getElementById('selecionar-evento');
            select.innerHTML = '<option value="">Selecione um evento...</option>';
            
            eventos.forEach(evento => {
                const option = document.createElement('option');
                option.value = evento.id;
                option.textContent = `${evento.cliente} - ${formatarData(evento.data)} - ${evento.tipoEvento}`;
                select.appendChild(option);
            });
            
            select.addEventListener('change', function() {
                const eventoId = parseInt(this.value);
                if (!eventoId) {
                    document.getElementById('detalhes-evento').style.display = 'none';
                    return;
                }
                
                const evento = eventos.find(e => e.id === eventoId);
                if (evento) {
                    document.getElementById('checklist-cliente').textContent = evento.cliente;
                    document.getElementById('checklist-data').textContent = formatarData(evento.data);
                    document.getElementById('checklist-local').textContent = evento.local;
                    
                    const checklistContainer = document.getElementById('checklist-equipamentos');
                    checklistContainer.innerHTML = '';
                    
                    evento.equipamentos.forEach(item => {
                        checklistContainer.innerHTML += `
                            <div class="checklist-item">
                                <div>
                                    <h4>${item.nome} (x${item.quantidade})</h4>
                                    <div style="display: flex; gap: 15px; margin-top: 5px;">
                                        <label><input type="checkbox"> Carregado</label>
                                        <label><input type="checkbox"> Caminhão</label>                                       
                                    </div>
                                </div>
                               
                            </div>
                        `;
                    });
                    
                    document.getElementById('detalhes-evento').style.display = 'block';
                }
            });
        }

        

        function salvarChecklist() {
            const eventoId = parseInt(document.getElementById('selecionar-evento').value);
            const responsavel = document.getElementById('responsavel').value;
            
            if (eventoId && responsavel) {
                const eventoIndex = eventos.findIndex(e => e.id === eventoId);
                if (eventoIndex !== -1) {
                    eventos[eventoIndex].responsavel = responsavel;
                    localStorage.setItem('eventosTag', JSON.stringify(eventos));
                    alert('Checklist salvo com sucesso!');
                }
            } 
        }

        function carregarListaEventos() {
            const container = document.getElementById('lista-eventos');
            container.innerHTML = '';
            
            if (eventos.length === 0) {
                container.innerHTML = '<p>Nenhum evento cadastrado ainda.</p>';
                return;
            }
            
            eventos.forEach(evento => {
                let statusClass = '';
                let statusText = '';
                
                if (evento.status === 'orcamento') {
                    statusClass = 'status-pendente';
                    statusText = 'ORÇAMENTO';
                } else if (evento.status === 'em_andamento') {
                    statusClass = 'status-concluido';
                    statusText = 'EM ANDAMENTO';
                } else if (evento.status === 'confirmado') {
                    statusClass = 'status-concluido';
                    statusText = 'CONFIRMADO';
                }
                
                const concluidos = evento.checklist ? evento.checklist.filter(item => item.carregado && item.montado && item.testado).length : 0;
                const total = evento.checklist ? evento.checklist.length : 0;
                
                container.innerHTML += `
                    <div class="checklist-item" style="margin-bottom: 20px;">
                        <div>
                            <h3>${evento.cliente}</h3>
                            <p><strong>Data:</strong> ${formatarData(evento.data)}</p>
                            <p><strong>Local:</strong> ${evento.local}</p>
                            <p><strong>Equipamentos:</strong> ${concluidos}/${total} </p>
                            ${evento.responsavel ? `<p><strong>Responsável:</strong> ${evento.responsavel}</p>` : ''}
                        </div>
                        <span class="status ${statusClass}">${statusText}</span>
                    </div>
                `;
            });
        }

        function formatarData(dataString) {
            if (!dataString) return '';
            const partes = dataString.split('-');
            if (partes.length === 3) {
                const [ano, mes, dia] = partes;
                return `${dia.padStart(2, '0')}/${mes.padStart(2, '0')}/${ano}`;
            }
            return dataString;
        }
        
        function novoOrcamento() {
            document.querySelector('.nav-link[data-page="eventos"]').click();
            abrirAba('orcamento');
        }

        // Calendário
        function renderCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            calendarGrid.innerHTML = '';
            
            // Atualizar cabeçalho com mês/ano atual
            document.getElementById('current-month').textContent = 
                `${monthNames[currentMonth]} ${currentYear}`;
            
            // Criar cabeçalhos dos dias da semana
            for (let i = 0; i < 7; i++) {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day';
                dayHeader.innerHTML = `<div class="day-header">${dayNames[i]}</div>`;
                calendarGrid.appendChild(dayHeader);
            }
            
            // Obter primeiro dia do mês e quantos dias tem o mês
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Criar dias vazios para o início do mês
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Criar os dias do mês
            const today = new Date();
            const currentDay = today.getDate();
            const currentMonthToday = today.getMonth();
            const currentYearToday = today.getFullYear();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                // Destacar o dia atual
                const isToday = day === currentDay && 
                                currentMonth === currentMonthToday && 
                                currentYear === currentYearToday;
                
                dayElement.innerHTML = `
                    <div class="day-header ${isToday ? 'today' : ''}">${day}</div>
                    <div class="day-events" id="events-${day}"></div>
                `;
                
                calendarGrid.appendChild(dayElement);
                
                // Adicionar eventos a este dia, se houver
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                addEventsToDay(day, dateStr);
            }
        }

        function addEventsToDay(day, dateStr) {
            // Formatar a data do calendário para YYYY-MM-DD
            const formattedDay = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            
            const dayEvents = eventos.filter(event => event.data === formattedDay);
            
            const eventsContainer = document.getElementById(`events-${day}`);
            
            if (!eventsContainer) return;
            
            eventsContainer.innerHTML = '';
            
            dayEvents.forEach(event => {
                const eventElement = document.createElement('div');
                eventElement.className = 'event-item';
                eventElement.textContent = `${event.cliente} - ${event.tipoEvento}`;
                eventElement.dataset.eventId = event.id;
                
                eventElement.addEventListener('click', function() {
                    openEventModal(event.id);
                });
                
                eventsContainer.appendChild(eventElement);
            });
        }

        function loadEventsList() {
            const eventosLista = document.getElementById('eventos-lista');
            eventosLista.innerHTML = '';
            
            if (eventos.length === 0) {
                eventosLista.innerHTML = '<p>Nenhum evento agendado</p>';
                return;
            }
            
            // Ordenar eventos por data
            eventos.sort((a, b) => new Date(a.data) - new Date(b.data));
            
            eventos.forEach(event => {
                // Usar a função formatarData em vez de toLocaleDateString
                const formattedDate = formatarData(event.data);
                
                const eventElement = document.createElement('div');
                eventElement.className = 'checklist-item';
                eventElement.innerHTML = `
                    <div>
                        <h3>${event.cliente} - ${event.tipoEvento}</h3>
                        <p><strong>Data:</strong> ${formattedDate}</p>
                        <p><strong>Local:</strong> ${event.local}</p>
                        <p><strong>Responsável:</strong> ${event.responsavel || 'A definir'}</p>
                    </div>
                    <span class="status status-concluido">CONFIRMADO</span>
                `;
                
                eventElement.addEventListener('click', function() {
                    openEventModal(event.id);
                });
                
                eventosLista.appendChild(eventElement);
            });
        }

        function openEventModal(eventId) {
            const event = eventos.find(e => e.id === eventId);
            if (!event) return;
            
            selectedEvent = event;
            
            const eventDate = new Date(event.data);
            const formattedDate = formatarData(event.data);

            document.getElementById('modal-title').textContent = `Evento #${event.id}`;
            document.getElementById('event-cliente').value = event.cliente;
            document.getElementById('event-data').value = formattedDate;
            document.getElementById('event-local').value = event.local;
            document.getElementById('event-tipo').value = event.tipoEvento;
            document.getElementById('event-responsavel').value = event.responsavel || '';
            document.getElementById('event-observacoes').value = event.observacoes || '';
            document.getElementById('btn-cancelar-evento').onclick = cancelEvent;
            // Listar equipamentos
            const equipamentosContainer = document.getElementById('event-equipamentos');
            equipamentosContainer.innerHTML = '';
            
            event.equipamentos.forEach(equip => {
                const equipElement = document.createElement('div');
                equipElement.textContent = `${equip.nome} (x${equip.quantidade})`;
                equipamentosContainer.appendChild(equipElement);
            });
            
            document.getElementById('event-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('event-modal').style.display = 'none';
            selectedEvent = null;
        }

        function saveEvent() {
            if (!selectedEvent) return;
            
            selectedEvent.responsavel = document.getElementById('event-responsavel').value;
            selectedEvent.observacoes = document.getElementById('event-observacoes').value;
            
            localStorage.setItem('eventosTag', JSON.stringify(eventos));
            closeModal();
            renderCalendar();
            loadEventsList();
            
            alert('Evento atualizado com sucesso!');
        }

        function cancelEvent() {
            // Verifica se há um evento selecionado
            if (!selectedEvent) {
                alert('Nenhum evento selecionado!');
                return;
            }
            
            

            try {
                // Encontra o índice do evento no array
                const eventIndex = eventos.findIndex(e => e.id === selectedEvent.id);
                
                // Verifica se o evento foi encontrado
                if (eventIndex === -1) {
                    throw new Error('Evento não encontrado no sistema');
                }

                // Remove o evento do array
                eventos.splice(eventIndex, 1);
                
                // Atualiza o localStorage
                localStorage.setItem('eventosTag', JSON.stringify(eventos));
                
                // Fecha o modal
                closeModal();
                
                // Atualiza a interface
                renderCalendar();
                loadEventsList();
                carregarListaEventos();
                
                // Feedback ao usuário
                alert('Evento cancelado com sucesso!');
            } catch (error) {
                console.error('Erro ao cancelar evento:', error);
                alert(`Falha ao cancelar evento: ${error.message}`);
            }
        }

        // Inicialização do calendário e eventos
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners para navegação no calendário
            document.getElementById('prev-month').addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar();
            });
            
            document.getElementById('next-month').addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar();
            });
            
            document.getElementById('today').addEventListener('click', function() {
                const today = new Date();
                currentMonth = today.getMonth();
                currentYear = today.getFullYear();
                renderCalendar();
            });
            
            // Event listeners para o modal
            document.getElementById('close-modal').addEventListener('click', closeModal);
            document.getElementById('btn-salvar-evento').addEventListener('click', saveEvent);
            document.getElementById('btn-cancelar-evento').addEventListener('click', cancelEvent);
            
            // Event listeners para o modal de confirmação de exclusão
            document.getElementById('btn-confirm-delete').addEventListener('click', deletarOrcamento);
            document.getElementById('btn-cancel-delete').addEventListener('click', fecharConfirmacaoExclusao);
        });
    </script>
</body>
</html>